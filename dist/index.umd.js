!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("fs"),require("path"),require("check-disk-space"),require("crypto"),require("uuid"),require("sfs-file-type"),require("file-type")):"function"==typeof define&&define.amd?define(["fs","path","check-disk-space","crypto","uuid","sfs-file-type","file-type"],r):(e||self).sfsNode=r(e.fs,e.path,e.checkDiskSpace,e.crypto,e.uuid,e.sfsFileType,e.fileType)}(this,function(e,r,t,n,i,o,u){function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=/*#__PURE__*/a(e),s=/*#__PURE__*/a(r),l=/*#__PURE__*/a(t);function c(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}return function(e){var r=e.publicFolder,t=e.mask,a=e.getFileById,d=e.getFileByHash,h=e.createFile,p=e.logger,y=e.uid,v=void 0===y?i.v4:y,m=function(e){return(t.endsWith("/")?t:t+"/")+e},P=function(e){try{return Promise.resolve(a(e)).then(function(e){if(e){var t=e.name;return{filePath:s.default.join(r,e.hash+e.extension),fileName:t}}})}catch(e){return Promise.reject(e)}};return{resolveFilePath:P,idToUrl:m,urlToId:function(e){return t.endsWith("/")?e.replace(t,""):e.replace(t+"/","")},saveFile:function(e,t){try{return Promise.resolve(c(function(){function i(){var n=s.default.join(r,l+c);return Promise.resolve(d(l)).then(function(r){function i(){if(r&&t===r.path)return p("File already exists at this location","error"),r.url=m(r.id),r;var e=(null==r?void 0:r.size)||f.default.statSync(n).size,i=(null==r?void 0:r.type)||o.dotExtensionToCategotry(c),u={id:v(),name:a,extension:c,hash:l,size:e,type:i,last_modified:Date.now(),path:t,publishedAt:Date.now()};return Promise.resolve(h(u)).then(function(e){return e.url=m(e.id),e})}var u=function(){if(!r)return p("SFS: Saving file","success"),Promise.resolve(e.mv(n)).then(function(){});p("SFS: File already uploaded","info")}();return u&&u.then?u.then(i):i()})}var a=decodeURI(e.name),l=n.createHash("sha256").update(e.data).digest("hex"),c="",y=s.default.extname(a),P=function(){if(!y)return Promise.resolve(u.fileTypeFromBuffer(e.data)).then(function(e){e&&(c="."+e.ext)});c=y}();return P&&P.then?P.then(i):i()},function(e){throw p("Upload error","error"),new Error(e)}))}catch(e){return Promise.reject(e)}},deleteFileByHash:function(e){try{try{var t=f.default.readdirSync(r).find(function(r){return r.split(".")[0]===e});if(!t)throw new Error("File with hash "+e+" not found in "+r);var n=s.default.join(r,t);f.default.unlinkSync(n)}catch(e){throw new Error(e)}return Promise.resolve()}catch(e){return Promise.reject(e)}},deleteFileById:function(e){try{return Promise.resolve(c(function(){return Promise.resolve(P(e)).then(function(e){var t=s.default.join(r,e.filePath);f.default.unlinkSync(t)})},function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}},getDiskUsage:function(e,t){try{return Promise.resolve(l.default(r))}catch(e){return Promise.reject(e)}}}}});
//# sourceMappingURL=index.umd.js.map
